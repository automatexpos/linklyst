{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="dashboard-content">
<h2>Dashboard</h2>

<!-- Always Visible: Analytics and Share Profile -->
<div class="form-section">
  <section class="card">
    <h3>Analytics Overview</h3>
    <div class="analytics-grid">
      <div class="stat-card">
        <h4>Total Links</h4>
        <span class="stat-number">{{ analytics.total_links }}</span>
      </div>
      <div class="stat-card">
        <h4>Total Clicks</h4>
        <span class="stat-number">{{ analytics.total_clicks }}</span>
      </div>
      <div class="stat-card">
        <h4>Categories</h4>
        <span class="stat-number">{{ analytics.categories_count }}</span>
      </div>
      <div class="stat-card">
        <h4>Subcategories</h4>
        <span class="stat-number">{{ analytics.subcategories_count }}</span>
      </div>
    </div>
    
    {% if analytics.trending_links %}
      <div class="top-links-section">
        <h4>Trending Links</h4>
        <div class="top-links-list">
          {% for link in analytics.trending_links %}
            <div class="top-link-item">
              <div class="link-info">
                <strong>{{ link.title }}</strong>
                <small>{{ link.url }}</small>
              </div>
              <div class="link-clicks">
                <span class="click-count">{{ link.clicks }}</span>
                <small>clicks</small>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </section>
</div>

<div class="form-section">
  <section class="card">
    <h3>Share Your Profile</h3>
    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
      Share this link to let people access all your links in one place:
    </p>
    <div class="profile-link-container">
      <a href="{{ site_base }}{{ url_for('public_profile', username=user.username) }}" 
         target="_blank" 
         class="public-link"
         id="profile-url">
        {{ site_base }}{{ url_for('public_profile', username=user.username) }}
      </a>
      <button onclick="copyProfileLink()" class="btn-copy" title="Copy link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      </button>
    </div>
  </section>
</div>
</div>

<!-- Modal Overlays -->
<!-- Profile Settings Modal -->
<div id="profile-modal" class="modal-overlay" style="display: none;">
  <div class="modal-backdrop" onclick="closeModal('profile-modal')"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>Profile Settings</h3>
      <button class="modal-close" onclick="closeModal('profile-modal')">&times;</button>
    </div>
    <div class="modal-body">
      <form method="post" action="{{ url_for('edit_profile') }}" enctype="multipart/form-data">
        <label>
          Display Name
          <input name="display_name" value="{{ profile.display_name or '' }}" placeholder="Your display name">
        </label>
        <label>
          Bio
          <textarea name="bio" placeholder="Tell people about yourself">{{ profile.bio or '' }}</textarea>
        </label>
        
        <div class="avatar-section">
          <label>Current Avatar</label>
          {% if profile.avatar_url %}
            <div class="current-avatar">
              <img src="{{ profile.avatar_url }}" alt="Current Avatar" class="avatar-preview">
            </div>
          {% else %}
            <div class="current-avatar">
              <div class="no-avatar">No avatar set</div>
            </div>
          {% endif %}
          
          <label>
            Upload New Avatar
            <input type="file" name="avatar_file" accept="image/*" class="file-input">
            <div class="file-input-helper">
              <span class="file-btn">Choose Image</span>
              <span class="file-text">Or drag and drop an image</span>
            </div>
          </label>
          
          <details class="avatar-url-option">
            <summary>Or use a URL instead</summary>
            <label>
              Avatar URL
              <input name="avatar_url" value="{{ profile.avatar_url or '' }}" placeholder="https://example.com/avatar.jpg">
            </label>
          </details>
        </div>
        <label>
          Theme
          <select name="theme">
            <option value="default" {% if profile.theme=='default' or not profile.theme %}selected{% endif %}>Default</option>
            <option value="dark" {% if profile.theme=='dark' %}selected{% endif %}>Dark</option>
            <option value="light" {% if profile.theme=='light' %}selected{% endif %}>Light</option>
            <option value="colorful" {% if profile.theme=='colorful' %}selected{% endif %}>Colorful</option>
          </select>
        </label>
        <div class="form-actions">
          <button class="btn" type="submit">Save Profile</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal('profile-modal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Categories Modal -->
<div id="categories-modal" class="modal-overlay" style="display: none;">
  <div class="modal-backdrop" onclick="closeModal('categories-modal')"></div>
  <div class="modal-content">
    <div class="modal-header">
      <div class="category-header-with-toggle">
        <h3>Categories</h3>
        <button class="add-category-toggle-btn" onclick="toggleAddCategoryForm()" id="toggleBtn">
          <span class="plus-icon">+</span>
          <span class="btn-text">Add Category</span>
        </button>
      </div>
      <button class="modal-close" onclick="closeModal('categories-modal')">&times;</button>
    </div>
    <div class="modal-body">
      <section class="card">
        <!-- Collapsible Form (Initially Hidden) -->
        <div class="add-category-form-container" id="addCategoryForm" style="display: none;">
          <form method="post" action="{{ url_for('add_category') }}" class="category-form" enctype="multipart/form-data">
            <label>
              Category Name
              <input name="name" placeholder="e.g. Bags, Shoes, Watches" required>
            </label>
            <label>
              Description
              <input name="description" placeholder="Brief description (optional)">
            </label>
            <label>
              Color
              <input name="color" type="color" value="#6366f1">
            </label>
            <label>
              Category Icon
              <input type="file" name="icon_file" accept="image/*" class="file-input">
              <div class="file-input-helper">
                <span class="file-btn">Choose Icon</span>
                <span class="file-text">Upload custom icon (optional)</span>
              </div>
            </label>
            <div class="form-actions">
              <button class="btn" type="submit">Add Category</button>
              <button type="button" class="btn btn-secondary" onclick="toggleAddCategoryForm()">Cancel</button>
            </div>
          </form>
        </div>

        {% if categories %}
          <div class="category-grid">
            {% for category in categories %}
              <div class="category-card" style="border-left: 4px solid {{ category.color }}">
                <div class="category-content" onclick="window.location.href='{{ url_for('category_subcategories', category_id=category.id) }}'">
                  <div class="category-header">
                    <h4>{{ category.name }}</h4>
                    <span class="subcategory-count">{{ category.subcategory_count or 0 }} subcategories ‚Ä¢ {{ category.direct_links_count or 0 }} direct links</span>
                  </div>
                  {% if category.description %}
                    <p class="category-description">{{ category.description }}</p>
                  {% endif %}
                </div>
                <div class="category-actions">
                  <button onclick="showShareModal({{ category.id }}, '{{ category.name }}')" class="share-btn" title="Get Shareable Link">üîó</button>
                  <a href="{{ url_for('edit_category', category_id=category.id) }}" class="edit-btn" title="Edit Category">‚úèÔ∏è</a>
                  <form method="post" action="{{ url_for('delete_category', category_id=category.id) }}" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this category? This will also delete all associated brands and links.')">
                    <button type="submit" class="delete-btn" title="Delete Category">üóëÔ∏è</button>
                  </form>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <p>No categories created yet. Add your first category above.</p>
          </div>
        {% endif %}
      </section>
    </div>
  </div>
</div>

  <!-- Brands Section (Commented Out) -->
  <!-- 
  <div class="collapsible-section">
    <button class="section-toggle" onclick="toggleSection('brands-section')">
      <span class="toggle-icon">‚ñ∂</span>
      <h3>Brands</h3>
    </button>
    <div id="brands-section" class="section-content" style="display: none;">
      <section class="card">
        <h4>Brands Overview</h4>
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
          Subcategories are organized within categories. Click on a category above, then manage subcategories and direct links within that category.
        </p>
        {% if categories %}
          <div class="category-quick-links">
            {% for category in categories %}
              <a href="{{ url_for('category_subcategories', category_id=category.id) }}" class="quick-link-btn" style="border-color: {{ category.color }}">
                <span style="color: {{ category.color }}">‚óè</span>
                {{ category.name }}
                <small>({{ category.subcategory_count or 0 }} subcategories)</small>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <p>Create categories first to organize your brands.</p>
          </div>
        {% endif %}
      </section>
    </div>
  </div>

  <!-- Links Section (Commented Out) -->
  <!--
  <div class="collapsible-section">
    <button class="section-toggle" onclick="toggleSection('links-section')">
      <span class="toggle-icon">‚ñ∂</span>
      <h3>Links</h3>
    </button>
    <div id="links-section" class="section-content" style="display: none;">
      <section class="card">
        <h4>Links Overview</h4>
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
          Links can be organized within subcategories or added directly to categories. Navigate to a category to manage links and subcategories.
        </p>
        {% if categories %}
          <div class="category-quick-links">
            {% for category in categories %}
              <a href="{{ url_for('category_subcategories', category_id=category.id) }}" class="quick-link-btn" style="border-color: {{ category.color }}">
                <span style="color: {{ category.color }}">‚óè</span>
                {{ category.name }}
                <small>({{ category.subcategory_count or 0 }} subcategories, {{ category.direct_links_count or 0 }} direct links)</small>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <p>Create categories first to organize your links and subcategories.</p>
          </div>
        {% endif %}
      </section>
    </div>
  </div>
  -->
</div>

<script>
function toggleSection(sectionId) {
  // Convert section IDs to modal IDs
  let modalId;
  if (sectionId === 'profile-section') {
    modalId = 'profile-modal';
  } else if (sectionId === 'categories-section') {
    modalId = 'categories-modal';
  }
  
  if (modalId) {
    openModal(modalId);
  }
}

function openModal(modalId) {
  const modal = document.getElementById(modalId);
  const dashboardContent = document.querySelector('.dashboard-content');
  
  if (modal && dashboardContent) {
    modal.style.display = 'flex';
    dashboardContent.classList.add('blur-background');
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
    
    // Remove active class from all nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    
    // Add active class to corresponding nav button
    const buttonText = modalId === 'profile-modal' ? 'Profile Settings' : 'Categories';
    const activeButton = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
      btn.textContent.trim() === buttonText
    );
    if (activeButton) {
      activeButton.classList.add('active');
    }
  }
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  const dashboardContent = document.querySelector('.dashboard-content');
  
  if (modal && dashboardContent) {
    modal.style.display = 'none';
    dashboardContent.classList.remove('blur-background');
    document.body.style.overflow = ''; // Restore scrolling
    
    // Remove active class from all nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.classList.remove('active');
    });
  }
}

// Close modal on ESC key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const openModals = document.querySelectorAll('.modal-overlay[style*="flex"]');
    openModals.forEach(modal => {
      closeModal(modal.id);
    });
  }
});

// Check URL parameters and open modal if specified
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const modalParam = urlParams.get('modal');
  
  if (modalParam === 'profile') {
    openModal('profile-modal');
    // Remove the parameter from URL without reloading
    window.history.replaceState({}, document.title, window.location.pathname);
  } else if (modalParam === 'categories') {
    openModal('categories-modal');
    // Remove the parameter from URL without reloading
    window.history.replaceState({}, document.title, window.location.pathname);
  }
});

// Enhanced delete confirmations
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('delete-btn')) {
    const form = e.target.closest('form');
    const action = form.action;
    
    let confirmMessage = 'Are you sure you want to delete this item?';
    
    if (action.includes('/category/') && action.includes('/delete')) {
      confirmMessage = 'Are you sure you want to delete this category?\n\nThis will permanently delete:\n‚Ä¢ The category\n‚Ä¢ All brands in this category\n‚Ä¢ All links associated with those brands\n\nThis action cannot be undone.';
    } else if (action.includes('/brand/') && action.includes('/delete')) {
      confirmMessage = 'Are you sure you want to delete this brand?\n\nThis will permanently delete:\n‚Ä¢ The brand\n‚Ä¢ All links associated with this brand\n\nThis action cannot be undone.';
    } else if (action.includes('/link/') && action.includes('/delete')) {
      confirmMessage = 'Are you sure you want to delete this link?\n\nThis action cannot be undone.';
    }
    
    if (!confirm(confirmMessage)) {
      e.preventDefault();
      return false;
    }
  }
});

function showShareModal(categoryId, categoryName) {
  const baseUrl = '{{ site_base }}';
  const username = '{{ user.username }}';
  
  // Generate shareable URLs (ensure baseUrl ends with slash)
  const normalizedBaseUrl = baseUrl.endsWith('/') ? baseUrl : baseUrl + '/';
  const categoryUrl = `${normalizedBaseUrl}u/${username}?category=${categoryId}`;
  const categoryDirectUrl = `${normalizedBaseUrl}u/${username}/category/${categoryId}`;
  
  const modal = document.createElement('div');
  modal.className = 'share-modal-overlay';
  modal.innerHTML = `
    <div class="share-modal">
      <div class="share-modal-header">
        <h3>Share "${categoryName}" Category</h3>
        <button onclick="closeShareModal()" class="close-btn">√ó</button>
      </div>
      
      <div class="share-modal-content">
        <div class="share-option">
          <label>Direct Category Link:</label>
          <div class="url-copy-container">
            <input type="text" value="${categoryUrl}" readonly onclick="this.select()">
            <button onclick="copyToClipboard('${categoryUrl}')" class="copy-btn">Copy</button>
          </div>
          <small>Opens your profile with this category expanded</small>
        </div>
        
        <div class="share-option">
          <label>Clean Category Link:</label>
          <div class="url-copy-container">
            <input type="text" value="${categoryDirectUrl}" readonly onclick="this.select()">
            <button onclick="copyToClipboard('${categoryDirectUrl}')" class="copy-btn">Copy</button>
          </div>
          <small>Redirects directly to the category</small>
        </div>
        
        <div class="share-tips">
          <strong>üí° Tips:</strong>
          <ul>
            <li>Share these links on social media to direct followers to specific categories</li>
            <li>Use in email signatures or business cards</li>
            <li>QR codes can be generated from these URLs</li>
          </ul>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

function closeShareModal() {
  const modal = document.querySelector('.share-modal-overlay');
  if (modal) {
    modal.remove();
  }
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    // Show success feedback
    const event = new Event('linkCopied');
    event.copiedText = text;
    document.dispatchEvent(event);
    
    // Visual feedback
    const buttons = document.querySelectorAll('.copy-btn');
    buttons.forEach(btn => {
      if (btn.onclick.toString().includes(text)) {
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        btn.style.background = '#10b981';
        setTimeout(() => {
          btn.textContent = originalText;
          btn.style.background = '';
        }, 2000);
      }
    });
  }).catch(() => {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    alert('Link copied to clipboard!');
  });
}

// Close modal when clicking outside
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('share-modal-overlay')) {
    closeShareModal();
  }
});
</script>

<!-- Share Modal Styles -->
<style>
.share-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.share-modal {
  background: white;
  border-radius: 12px;
  width: 90%;
  max-width: 600px;
  max-height: 90vh;
  overflow-y: auto;
}

.share-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-light);
}

.share-modal-header h3 {
  margin: 0;
  color: var(--text-primary);
}

.close-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.5rem;
  color: var(--text-muted);
}

.share-modal-content {
  padding: 1.5rem;
}

.share-option {
  margin-bottom: 1.5rem;
}

.share-option label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--text-primary);
}

.url-copy-container {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

.url-copy-container input {
  flex: 1;
  padding: 0.75rem;
  border: 2px solid var(--border-light);
  border-radius: 6px;
  font-family: monospace;
  font-size: 0.9rem;
  background: var(--bg-light);
}

.copy-btn {
  padding: 0.75rem 1rem;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s;
}

.copy-btn:hover {
  background: var(--primary-dark);
}

.share-option small {
  color: var(--text-muted);
  font-size: 0.85rem;
}

.share-tips {
  background: var(--bg-light);
  padding: 1rem;
  border-radius: 6px;
  margin-top: 1.5rem;
}

.share-tips ul {
  margin: 0.5rem 0 0 1rem;
  padding: 0;
}

.share-tips li {
  margin-bottom: 0.25rem;
}

.share-btn {
  background: var(--primary);
  color: white;
  border: none;
  padding: 0.5rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: background 0.2s;
}

.share-btn:hover {
  background: var(--primary-dark);
}

/* Collapsible Category Form Styles */
.category-header-with-toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  width: 100%;
}

.category-header-with-toggle h3 {
  margin: 0;
  flex: 1;
}

.add-category-toggle-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: var(--primary);
  color: white;
  border: none;
  padding: 0.75rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease;
  font-size: 0.9rem;
  white-space: nowrap;
}

.add-category-toggle-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

.add-category-toggle-btn.active {
  background: #dc3545;
}

.add-category-toggle-btn.active:hover {
  background: #c82333;
}

.plus-icon {
  font-size: 1.2rem;
  font-weight: bold;
  transition: transform 0.2s ease;
}

.add-category-toggle-btn.active .plus-icon {
  transform: rotate(45deg);
}

.add-category-form-container {
  overflow: hidden;
  transition: all 0.3s ease;
  margin-bottom: 1rem;
}

.add-category-form-container .category-form {
  animation: slideDown 0.3s ease;
  border: 1px solid var(--border-light);
  border-radius: 6px;
  padding: 1.5rem;
  background: var(--bg-light);
  margin-top: 1rem;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-light);
}

.modal-close {
  position: absolute;
  right: 1rem;
  top: 1rem;
}

/* Profile Link Container */
.profile-link-container {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  background: var(--bg-light);
  border-radius: 8px;
  border: 1px solid var(--border-light);
}

.profile-link-container .public-link {
  flex: 1;
  text-decoration: none;
  color: var(--primary-solid);
  font-family: monospace;
  font-size: 0.9rem;
  word-break: break-all;
}

.profile-link-container .public-link:hover {
  text-decoration: underline;
}

.btn-copy {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
  background: var(--primary-solid);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  min-width: 36px;
  height: 36px;
}

.btn-copy:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
}

.btn-copy:active {
  transform: translateY(0);
}
</style>

<script>
// Collapsible category form functionality
function toggleAddCategoryForm() {
  const form = document.getElementById('addCategoryForm');
  const toggleBtn = document.getElementById('toggleBtn');
  const plusIcon = toggleBtn.querySelector('.plus-icon');
  const btnText = toggleBtn.querySelector('.btn-text');
  
  if (form.style.display === 'none' || form.style.display === '') {
    // Show form
    form.style.display = 'block';
    plusIcon.textContent = '√ó';
    btnText.textContent = 'Cancel';
    toggleBtn.classList.add('active');
    
    // Focus on the first input
    setTimeout(() => {
      const firstInput = form.querySelector('input[name="name"]');
      if (firstInput) firstInput.focus();
    }, 100);
  } else {
    // Hide form
    form.style.display = 'none';
    plusIcon.textContent = '+';
    btnText.textContent = 'Add Category';
    toggleBtn.classList.remove('active');
    
    // Clear form
    const formElement = form.querySelector('form');
    if (formElement) formElement.reset();
  }
}

// Initialize form state when modal opens
document.addEventListener('DOMContentLoaded', function() {
  const categoriesModal = document.getElementById('categories-modal');
  if (categoriesModal) {
    // Watch for modal open events
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          const modal = mutation.target;
          if (modal.style.display === 'flex') {
            // Modal is opening, reset form state
            const form = document.getElementById('addCategoryForm');
            const toggleBtn = document.getElementById('toggleBtn');
            if (form && toggleBtn) {
              const plusIcon = toggleBtn.querySelector('.plus-icon');
              const btnText = toggleBtn.querySelector('.btn-text');
              
              // Force form to be hidden
              form.style.display = 'none';
              plusIcon.textContent = '+';
              btnText.textContent = 'Add Category';
              toggleBtn.classList.remove('active');
            }
          }
        }
      });
    });
    
    observer.observe(categoriesModal, { attributes: true });
  }
});

// Copy profile link functionality
function copyProfileLink() {
  const profileLink = document.getElementById('profile-url');
  const linkText = profileLink.textContent.trim();
  
  // Use the modern clipboard API if available
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(linkText).then(() => {
      showCopyFeedback();
    }).catch(() => {
      fallbackCopyText(linkText);
    });
  } else {
    // Fallback for older browsers
    fallbackCopyText(linkText);
  }
}

function fallbackCopyText(text) {
  // Create a temporary textarea element
  const textArea = document.createElement('textarea');
  textArea.value = text;
  textArea.style.position = 'fixed';
  textArea.style.left = '-999999px';
  textArea.style.top = '-999999px';
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    showCopyFeedback();
  } catch (err) {
    console.error('Failed to copy text: ', err);
  }
  
  document.body.removeChild(textArea);
}

function showCopyFeedback() {
  const copyBtn = document.querySelector('.btn-copy');
  const originalContent = copyBtn.innerHTML;
  
  // Show checkmark
  copyBtn.innerHTML = `
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20,6 9,17 4,12"></polyline>
    </svg>
  `;
  copyBtn.style.background = 'var(--success)';
  
  // Reset after 2 seconds
  setTimeout(() => {
    copyBtn.innerHTML = originalContent;
    copyBtn.style.background = 'var(--primary-solid)';
  }, 2000);
}
</script>
{% endblock %}